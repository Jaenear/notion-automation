<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>내 구글 캘린더</title>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js'></script>
    <script src='https://cdn.jsdelivr.net/npm/@fullcalendar/google-calendar@6.1.8/index.global.min.js'></script>
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.css' rel="stylesheet' />
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
        }
        #calendar {
            max-width: 900px;
            margin: 0 auto;
            background-color: #ffffff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .fc-toolbar-chunk {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: none;
        }
    </style>
</head>
<body>
    <div id='calendar'></div>
    <iframe src="https://{username}.github.io/{repository-name}/weekly_summary.html"></iframe>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var calendarEl = document.getElementById('calendar');

            var calculateTotalHours = function(events) {
                var totals = {
                    '이재준': 0,
                    '박동재': 0,
                    '박상준': 0,
                    '최람': 0
                };

                var dailyTotals = {
                    '이재준': [0, 0, 0, 0, 0, 0, 0],
                    '박동재': [0, 0, 0, 0, 0, 0, 0],
                    '박상준': [0, 0, 0, 0, 0, 0, 0],
                    '최람': [0, 0, 0, 0, 0, 0, 0]
                };

                events.forEach(function(event) {
                    var description = event.extendedProps.description;
                    var duration = (event.end - event.start) / (1000 * 60 * 60); // duration in hours
                    var day = event.start.getDay();

                    if (description.includes("원본 캘린더: J.업무 부여")) {
                        totals['이재준'] += duration;
                        dailyTotals['이재준'][day] += duration;
                    } else if (description.includes("원본 캘린더: D. 업무배분")) {
                        totals['박동재'] += duration;
                        dailyTotals['박동재'][day] += duration;
                    } else if (description.includes("원본 캘린더: S. 업무시간")) {
                        totals['박상준'] += duration;
                        dailyTotals['박상준'][day] += duration;
                    } else if (description.includes("원본 캘린더: R.업무배분")) {
                        totals['최람'] += duration;
                        dailyTotals['최람'][day] += duration;
                    }
                });

                var weeklyTotal = totals['이재준'] + totals['박동재'] + totals['박상준'] + totals['최람'];
                localStorage.setItem('weeklyTotal', formatHours(weeklyTotal));
                localStorage.setItem('totals', JSON.stringify(totals));
                localStorage.setItem('dailyTotals', JSON.stringify(dailyTotals));
            };

            var formatHours = function(hours) {
                var h = Math.floor(hours);
                var m = Math.round((hours - h) * 60);
                return h + '시간 ' + (m > 0 ? m + '분' : '');
            };

            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'timeGridWeek',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay'
                },
                themeSystem: 'standard',
                height: 'auto',
                editable: true,
                nowIndicator: true,
                displayEventTime: false,
                googleCalendarApiKey: 'AIzaSyBxy_-u0lehrEdwkANFkFcHDiyHhh5Lksk',
                eventSources: [
                    { 
                        googleCalendarId: '8fb5e33241ef86464dee64717ccc157725314f7c8f036ee53cb7b771fbb7f446@group.calendar.google.com'
                    }
                ],
                eventsSet: function(events) {
                    calculateTotalHours(events);
                }
            });

            calendar.render();
        });
    </script>
</body>
</html>
